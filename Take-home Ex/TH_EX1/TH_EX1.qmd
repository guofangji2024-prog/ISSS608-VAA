---
title: "Take-home Exercise 1: Survey Analysis with Data Visualisation"
author: "Guofang Ji"
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 3
    code-fold: false
    code-tools: true
---

## Introduction

This report uses the dataset **"Income of informal labourers in rural areas: A survey dataset of northern mountainous regions in Vietnam"** (Mai et al., *Data in Brief* 38, 2021). Survey analysis transforms raw survey data into decision-relevant insights by identifying patterns, trends, and relationships using descriptive and visual methods. The analysis below applies **tidyverse** and **ggplot2** to load, prepare, and visualise the data.

::: callout-note
## Data source

Raw data: spreadsheet (725 rows × 29 columns) from Mendeley Data, stored in the project `data/` folder.

**Link**: <https://data.mendeley.com/datasets/s6p7dwj3j6/1> (DOI: 10.17632/s6p7dwj3j6.1)
:::

## Data and methods

### Packages and data import

```{r}
pacman::p_load(tidyverse, patchwork, scales, readxl, viridis, ggstatsplot, DT)
```

*Upload for elsiver.xlsx* is read with **readxl**’s [`read_excel()`](https://readxl.tidyverse.org/reference/read_excel.html). Categorical columns are converted to character; then **recode** is used so that every chart shows meaningful labels instead of numeric codes (Mai et al. 2021, Table 1).

```{r}
# Province codes 1--5: Tuyen Quang, Quang Ninh, Ha Giang, Yen Bai, Bac Giang (Mai et al. 2021)
survey <- read_excel("data/Upload for elsiver.xlsx") %>%
  mutate(across(where(is.character), ~ na_if(., ""))) %>%
  mutate(across(any_of(c("CPRO", "CGEN", "CRAC", "CJOB", "CQUI", "FEDU", "FVTP", "FCRA", "FTAP")), as.character)) %>%
  filter(is.finite(TEIN)) %>%
  mutate(
    CGEN = factor(CGEN, levels = c("1", "2"), labels = c("Male", "Female")),
    CPRO = recode(CPRO,
                  "1" = "Tuyen Quang", "2" = "Quang Ninh", "3" = "Ha Giang",
                  "4" = "Yen Bai", "5" = "Bac Giang"),
    FEDU_label = recode(as.character(FEDU),
                        "0" = "No formal", "1" = "Primary", "2" = "Secondary",
                        "3" = "Higher", .default = NA_character_),
    FCRA = recode(as.character(FCRA),
                  "1" = "Low", "2" = "Medium", .default = NA_character_),
    FCRA = fct_relevel(factor(FCRA), "Low", "Medium"),
    CRAC = factor(recode(as.character(CRAC),
                        "1" = "Kinh", "2" = "Ethnic minority", .default = NA_character_),
                  levels = c("Kinh", "Ethnic minority"))
  )
survey
```

One row with missing or non-finite total income (TEIN) is excluded; the analytic sample has 724 rows and 29 columns. Variables used (see Mai et al. 2021, Table 1 for the full codebook):

-   **Characteristics**: CPRO (province), CGEN (gender), CRAC (race), CJOB (career), CQUI (income quintile).
-   **Income** (Mil VND): TEIN (total income), TAIN (agricultural), TSII (service and industrial), TOIN (others).
-   **Factors**: FEDU (education), FVTP (vocational training), FCRA (credit accessibility), FTAP (technological application). FCRA has two levels in this dataset (Low / Medium; Mai et al. 2021, Table 1); CRAC (race) is mapped to Kinh / Ethnic minority. All categorical variables use readable labels; FCRA is ordered Low → Medium.

**Data preview** (searchable, sortable table):

```{r}
#| label: tbl-preview
#| tbl-cap: "Survey data preview (724 rows)"
DT::datatable(survey, filter = "top", options = list(pageLength = 10))
```

### Data preparation

Data are kept in tidy form; summary tables are built with **dplyr**.

Summary by province:

```{r}
by_province <- survey %>%
  group_by(CPRO) %>%
  summarise(
    n = n(),
    mean_income = mean(TEIN, na.rm = TRUE),
    .groups = "drop"
  )
by_province
```

Summary by race:

```{r}
by_race <- survey %>%
  count(CRAC, name = "count") %>%
  mutate(pct = count / sum(count) * 100)
by_race
```

Summary by education level (with readable labels for plotting):

```{r}
by_edu <- survey %>%
  filter(!is.na(FEDU_label)) %>%
  group_by(FEDU_label, FEDU) %>%
  summarise(
    n = n(),
    mean_tein = mean(TEIN, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(FEDU_label = fct_reorder(FEDU_label, mean_tein))
by_edu
```

## Working with Geometric objects

### Histogram of total income (TEIN)

```{r}
#| fig-cap: "Distribution of total income (Mil VND)"
p1 <- ggplot(data = survey, aes(x = TEIN)) +
  geom_histogram(bins = 20, colour = "grey25", fill = "grey85") +
  labs(title = "Distribution of total income of informal rural labourers",
       x = "Total income (Mil VND)", y = "Count") +
  theme_minimal()
p1
```

The histogram shows that total income (TEIN) in the sample is right-skewed. Most informal labourers have total income between about 20 and 50 million VND; the centre of the distribution lies in this range. The spread is wide, with a long right tail indicating a minority with much higher income. This pattern implies substantial inequality among rural informal workers in the northern mountainous regions: most earn modest amounts, while a smaller group earns considerably more, possibly reflecting different types of informal work or access to better opportunities.

### Total income by gender (with statistical test)

Boxplot with mean (red point); statistical evidence is provided by **ggstatsplot** (non-parametric Mann–Whitney test) so the conclusion is not based on visual overlap alone.

```{r}
#| fig-cap: "Total income by gender"
p2 <- ggplot(data = survey, aes(y = TEIN, x = CGEN)) +
  geom_boxplot(notch = TRUE, fill = "grey92") +
  stat_summary(geom = "point", fun = "mean", colour = "red", size = 4) +
  labs(x = "Gender", y = "Total income (Mil VND)", title = "Total income by gender") +
  theme_minimal() +
  theme(legend.position = "none")
p2
```

```{r}
#| fig-cap: "Total income by gender — Mann-Whitney test"
ggbetweenstats(data = survey, x = CGEN, y = TEIN, type = "np",
               title = "Total income by gender", xlab = "Gender", ylab = "Total income (Mil VND)")
```

The test confirms that the difference in total income between males and females is not statistically significant (*p* shown in the plot). Medians and distributions are similar; the gender income gap among these informal rural labourers is small relative to variation within each group.

### Plotting a bar chart

[`geom_bar()`](https://ggplot2.tidyverse.org/reference/geom_bar.html) counts respondents by province; `coord_flip()` gives a horizontal bar chart.

```{r}
#| fig-cap: "Number of respondents by province"
p3 <- ggplot(data = survey, aes(x = fct_infreq(CPRO))) +
  geom_bar(fill = "steelblue", alpha = 0.85) +
  coord_flip() +
  labs(x = NULL, y = "Count", title = "Number of respondents by province") +
  theme_minimal()
p3
```

Respondent counts are fairly balanced across the five provinces (Tuyen Quang, Quang Ninh, Ha Giang, Yen Bai, Bac Giang), with sample sizes around 141–150 per province. This balance supports comparisons of income and other outcomes by province.

### Mean total income by education level

Pre-summarised data with [`geom_col()`](https://ggplot2.tidyverse.org/reference/geom_col.html); **viridis** (mako) encodes the gradient; bar-end labels avoid axis alignment.

```{r}
#| fig-cap: "Mean total income by education level"
p4 <- ggplot(by_edu, aes(x = FEDU_label, y = mean_tein, fill = mean_tein)) +
  geom_col(alpha = 0.9) +
  geom_text(aes(label = round(mean_tein, 1)), hjust = -0.2, size = 3.2) +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, 0.12))) +
  scale_fill_viridis_c(option = "mako", direction = -1) +
  labs(
    title = "Education is the key income driver",
    subtitle = "Higher education earners make ~4.5× more than those with no formal schooling",
    x = "Education level", y = "Mean total income (Mil VND)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
p4
```

There is a clear positive association between education level and mean total income. Mean income rises from about 29 Mil VND (no formal) to 43, 60, and about 132 Mil VND for primary, secondary, and higher education. The highest category earns substantially more, supporting the importance of education for income in this population and suggesting that policies aimed at schooling and training could improve outcomes for informal labourers in the northern mountainous regions.

### Kernel density plot

Kernel density of total income by gender, with *colour* and *fill* in `aes()` for two groups.

```{r}
#| fig-cap: "Density of total income by gender"
p5 <- ggplot(data = survey, aes(x = TEIN, colour = CGEN, fill = CGEN)) +
  geom_density(alpha = 0.3, linewidth = 0.8) +
  labs(x = "Total income (Mil VND)", y = "Density", title = "Total income distribution by gender") +
  theme_minimal()
p5
```

The two density curves overlap heavily, with peaks in a similar range (roughly 25–45 Mil VND). Spread and shape are similar for both gender groups; there is no strong shift of one distribution relative to the other. The overlap indicates that the income distribution is largely similar for males and females in this sample. Any small differences in peak location or tail length are minor compared with the shared pattern of moderate centre and right-skewed spread.

## Working with facets

### Working with facet_wrap()

[`facet_wrap()`](https://ggplot2.tidyverse.org/reference/facet_wrap.html) gives a trellis of total income by province.

```{r}
#| fig-cap: "Total income distribution by province"
p6 <- ggplot(data = survey, aes(x = TEIN)) +
  geom_histogram(bins = 25, colour = "grey25", fill = "steelblue", alpha = 0.8) +
  facet_wrap(~ CPRO, ncol = 2) +
  labs(x = "Total income (Mil VND)", y = "Count", title = "Total income distribution by province") +
  theme_minimal()
p6
```

The five panels show that income distribution shape and centre vary by province. Tuyen Quang, Quang Ninh, Ha Giang and Bac Giang have similar centres (mean income around 38–41 Mil VND), while **Yen Bai** has a lower centre (about 33 Mil VND). Yen Bai is a well-known mountainous province in northern Vietnam; its terrain may limit non-agricultural development and market access, which aligns with the lower income centre seen in the data. All panels are right-skewed, but spread and right-tail length differ. This regional heterogeneity—and the distinct position of Yen Bai—suggests that geography and local economic structure matter for informal labourers’ income and is a useful direction for further analysis or policy targeting in the northern mountainous regions.

## Total income by credit accessibility

Boxplot of total income by credit accessibility; statistical evidence from **ggstatsplot** (non-parametric test) to support policy-relevant conclusions.

```{r}
#| fig-cap: "Total income by credit accessibility"
p7 <- ggplot(data = survey %>% filter(!is.na(FCRA)), aes(y = TEIN, x = FCRA)) +
  geom_boxplot(notch = FALSE, fill = "grey92") +
  stat_summary(geom = "point", fun = "mean", colour = "red", size = 4) +
  labs(x = "Credit accessibility", y = "Total income (Mil VND)", title = "Total income by credit accessibility") +
  theme_minimal() +
  theme(legend.position = "none")
p7
```

```{r}
#| fig-cap: "Total income by credit accessibility — statistical test"
ggbetweenstats(
  data = survey %>% filter(!is.na(FCRA)),
  x = FCRA, y = TEIN, type = "np",
  title = "Total income by credit accessibility",
  xlab = "Credit accessibility", ylab = "Total income (Mil VND)"
)
```

The boxplots and test show how total income varies across credit accessibility (Low vs Medium). The *p*-value in the figure indicates whether the difference is statistically significant—relevant for policy: if easier credit access is associated with higher income, interventions to improve credit access may help informal labourers in the northern mountainous regions.

## Total income by race

The sample includes a large share of ethnic minorities (by_race shows \~54% in group 2). In northern mountainous Vietnam, race is a potential driver of income inequality. Below: boxplot and **ggstatsplot** for total income by race (Kinh vs Ethnic minority).

```{r}
#| fig-cap: "Total income by race"
p8 <- ggplot(data = survey %>% filter(!is.na(CRAC)), aes(y = TEIN, x = CRAC)) +
  geom_boxplot(notch = TRUE, fill = "grey92") +
  stat_summary(geom = "point", fun = "mean", colour = "red", size = 4) +
  labs(x = "Race", y = "Total income (Mil VND)", title = "Total income by race") +
  theme_minimal() +
  theme(legend.position = "none")
p8
```

```{r}
#| fig-cap: "Total income by race — statistical test"
ggbetweenstats(
  data = survey %>% filter(!is.na(CRAC)),
  x = CRAC, y = TEIN, type = "np",
  title = "Total income by race",
  xlab = "Race", ylab = "Total income (Mil VND)"
)
```

The plot and test show whether total income differs significantly between Kinh and Ethnic minority labourers. In this region, ethnic minority status often correlates with remoteness and limited access to markets and services; a significant income gap would support targeted policies for inclusive development.

## Composite figure (patchwork)

[**patchwork**](https://patchwork.data-imaginist.com/) combines plots; `/` stacks them vertically. [`plot_annotation()`](https://patchwork.data-imaginist.com/reference/plot_annotation.html) with `tag_levels = 'I'` adds panel labels.

```{r}
#| fig-cap: "Composite: income distribution, by gender, and by education"
p1 / p2 / p4 +
  plot_annotation(
    title = "Income of informal rural labourers: distribution and by gender and education",
    tag_levels = "I"
  )
```

Panel I shows the overall income distribution is right-skewed, with most labourers in the lower–middle income range. Panel II indicates that the gender gap in total income is small; medians and means are similar for both groups. Panel III shows a strong education–income gradient: mean income rises sharply with education level. Taken together, the main findings are: (1) income among these informal rural labourers is uneven and right-skewed; (2) gender differences in income are modest; and (3) education is a strong predictor of higher mean income, suggesting that policies supporting education may help improve outcomes in this population.

## References

-   Mai, A.N., Pham, T.H., Hoang, H.T., Nguyen, H.H.T. (2021). Income of informal labourers in rural areas: A survey dataset of northern mountainous regions in Vietnam. *Data in Brief* 38, 107292. <https://doi.org/10.1016/j.dib.2021.107292>
-   Mendeley Data: <https://data.mendeley.com/datasets/s6p7dwj3j6/1>
-   Creating enlightening and truthful data visualization. *Procedia Computer Science* (2021).
-   Wickham et al., *ggplot2: Elegant Graphics for Data Analysis*. Springer.
